 - checkout: self
 submodules: recursive
      
- task: NuGetToolInstaller@1
    displayName: 'Install NuGet'
      
- task: NuGetCommand@2
    displayName: 'Restore packages'
    inputs:
    restoreSolution: 'Source\Zafiro.sln'
      
- task: MSBuild@1
    displayName: 'Build solution in $(buildConfiguration) | $(buildPlatform)'
    inputs:
    solution: 'Source\Zafiro.sln'
    msbuildLocationMethod: version
    msbuildVersion: latest
    msbuildArchitecture: x86
    configuration: $(buildConfiguration)
    platform: $(buildPlatform)
    msbuildArguments: /p:PackageVersion=$(NugetVersion) # Set the version of the packages, will have no effect on application projects (Heads).
        
- task: CopyFiles@2
    inputs:
    SourceFolder: 'Source'
    Contents: '**\Zafiro*.nupkg'
    TargetFolder: '$(build.artifactstagingdirectory)'
    flattenFolders: true

- task: PublishBuildArtifacts@1
    displayName: 'Publish artifact $(ApplicationConfiguration)'
    inputs:
    PathtoPublish: '$(Build.ArtifactStagingDirectory)'
    ArtifactName: 'Nuget Packages'
    publishLocation: 'Container'