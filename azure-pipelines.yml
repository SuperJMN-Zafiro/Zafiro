variables:
- group: api-keys
- name: Agent.Source.Git.ShallowFetchDepth
  value: 0

steps:
- checkout: self

- pwsh: dotnet tool install --global DotnetPackaging.DeployerTool
  displayName: Install DotnetPackaging.DeployerTool

- pwsh: |
    $args = if ($env:BUILD_SOURCEBRANCH -ne 'refs/heads/master') { '--no-push' } else { '' }
    dotnetdeployer nuget --api-key $env:NUGET_API_KEY $args
  displayName: Publish NuGet packages
  env:
    NUGET_API_KEY: $(NuGetApiKey)
